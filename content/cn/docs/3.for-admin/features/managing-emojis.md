# 管理自定义表情符号

:::warning

该文件正在施工。注意，有可能包含过时信息。

:::

自定义表情符号可由管理员/监察员和具有“自定义表情符号管理”权限的角色用户进行管理，方法是从“设置”中访问“自定义表情符号”页面的子菜单。
默认情况下会显示当前本地安装的表情符号列表。
刚开始这个列表是空的，但可以通过多种方式添加自定义表情符号。

## 从其他实例（服务器）复制表情符号

您可以轻松地从其他实例复制表情符号。

首先，切换到自定义表情符号设置中的“远程”标签页。您可以通过名称或主机名（域名）来搜索表情符号。

找到想要的表情符号后，点击它以打开菜单，即可导入该表情符号。

请注意，表情符号可能受到著作权保护，因此在使用前请务必确认相关权利，确保该表情符号可以合法使用。

## 导入单个的表情符号

如果你有想设为自定义表情符号的图片文件，可以将该图片作为表情符号导入。

:::danger

如果从网盘导入表情符号，文件会仍然保留在网盘中。
由于 Misskey 不会为该文件创建副本，如果你删除该文件，表情符号将无法显示。

:::

表情符号会被添加到服务器，之后即可像平常一样进行编辑或删除。

## 批量导入

表情符号可以以特定格式打包的 ZIP 文件进行批量导入。
此功能可通过自定义表情符号菜单右上角的菜单按钮使用。

:::warning

批量导入可能会覆盖现有的表情符号，或对服务器造成问题。
请尽量只导入您自行导出的表情符号；若需从外部进行批量导入，请务必确认来源是否可信。

:::

### 打包的表情符号格式

在顶层目录中，必须包含一个名为 `meta.json` 的文件，该文件包含有关该打包表情符号的相关信息。

该文件的类型定义如下，其中 `Meta` 表示整个文件的结构。

```typescript
class Meta {
	metaVersion: number;
	host: string;
	/**
	 * ECMAScript の `Date.prototype.toString` によって返される日時の表現。
	 */
	exportedAt: string;
	emojis: Emoji[];
}

class Emoji {
	downloaded: boolean;
	fileName: string;
	emoji: {
		id: string;
		updatedAt: string;
		name: string;
		host: null;
		category: string;
		originalUrl: string;
		publicUrl: string;
		uri: null;
		type: string;
		aliases: string[];
	};
}
```

目前，在导入表情符号时，`Meta` 字段不会被使用或检查，但 `emojis` 字段会被使用。

对于每个 `Emoji`：

- `downloaded`：必须始终设置为 true。如果此字段不存在，或其值不为 true，该表情符号将不会被导入。
- `fileName`：打包文件中图片文件的文件名。
- `emoji`：与数据库中保存的表情符号相关的数据。目前会使用以下字段：
  - `name`：用户输入的表情符号名称，例如 `blobfox`（当用户输入 `:blobfox:` 时，该表情符号会显示）。  
    如果已存在同名的表情符号，**将会被覆盖**
  - `category`：表情符号的分类
  - `aliases`：作为别名添加的字符串列表。在管理员 UI 中，这些被称为“标签”。

## 编辑和删除表情符号

在本地表情符号列表中，点击表情符号即可编辑其属性。
点击自定义表情符号后，会打开用于编辑其属性的对话框。
在该对话框中，也可以删除该表情符号。

:::danger

删除自定义表情符号后，包含该表情符号的旧贴子中将仅以文本形式显示表情符号名称，该表情符号将无法正确显示。

:::

请注意，远程表情符号无法编辑或删除。

每个表情符号都可以有一个名称、一个类别，以及多个标签。
类别用于对表情符号选择器进行结构化；在表情符号选择器中搜索时，标签会作为查找表情符号时使用的别名。

编辑完成后，请点击对话框右上角的勾号图标以保存更改。

### 批量编辑

表情符号可以通过勾选搜索字段下方的框来进行批量编辑。
启用此功能后，点击表情符号将不会打开编辑对话框，而是直接选择该表情符号。

编辑选项会以按钮形式显示在该复选框下方。
要恢复默认行为，请再次取消勾选该复选框。
