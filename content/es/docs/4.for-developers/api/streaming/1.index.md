---
description: 'La API de Streaming te permite recibir diversos tipos de información (por ejemplo, nuevas publicaciones en tu línea de tiempo, reacciones, seguidores, etc.) y realizar diversas operaciones en tiempo real.'
---

# Streaming API

:::tip

Se recomienda leer primero la documentación de la [API de Misskey](../index.md)

:::

La API de Streaming te permite recibir diversos tipos de información (por ejemplo, nuevas publicaciones en tu línea de tiempo, reacciones, seguidores, etc.) y realizar diversas operaciones en tiempo real.

## Conectarse al Stream (Flujo de datos)

Para utilizar la API de streaming, primero debes conectarte al servidor de Misskey a través de **websocket**.

Conéctate via Websocket a una URL con el siguiente formato:

```
wss://{host}/streaming?i={token}
```

Aquí

- Sustituye `{host}` por el nombre del servidor al que deseas conectarte.
- Sustituye el `{token}` por el token de acceso del usuario.

:::tip

El token de acceso puede omitirse, pero esto significa un uso no registrado, lo que limita la información que puede recibirse y las operaciones posibles.

:::

Una vez conectado al stream, puedes suscribirte a las entradas descritas a continuación, pero aún no puedes recibir nuevas entradas en la línea de tiempo, por ejemplo, en esta fase.
Para recibir este tipo de eventos, debes conectarte al **canal** descrito a continuación en el stream.

**Todos los intercambios en el stream tienen formato JSON.**

## Canales

La API de streaming de Misskey tiene el concepto de canales.Se trata de un mecanismo para separar la información que se envía y la que se recibe.
La conexión a canales en un stream permite recibir varios tipos de información y transmitir información.

:::tip

Es posible conectarse a varios canales simultáneamente en una sola conexión de stream.

:::

A continuación se describe cómo utilizar los canales.Para ver los canales disponibles, consulta la [lista de canales] (./channel/index.md).

### Conectarse al canal

Para conectarse a un canal, envía los siguientes datos al flujo en JSON:

```js
{
	type: 'connect',
	body: {
		channel: 'xxxxxxxx',
		id: 'foobar',
		params: {
			...
		}
	}
}
```

Aquí

- Pon en `channel` al nombre del canal al que quieres conectarte.[Lista de canales] (./channel/index.md).
- Establece `id` a un ID arbitrario para interactuar con el canal.Esto se debe a que en el flujo se reproducen diferentes mensajes y es necesario identificar de qué canal procede el mensaje.Este ID puede ser un UUID o un número aleatorio.
- Los `params` son los parámetros para conectarse al canal.Los distintos canales requieren parámetros diferentes para la conexión.Esta propiedad puede omitirse cuando se conecta a un canal sin parámetros.

:::tip

Estos ID deben ser únicos para cada conexión a un canal, no sólo para cada canal.Esto se debe a que puede haber varias conexiones al mismo canal con diferentes parámetros al mismo tiempo.

:::

### Tratamiento de los mensajes entrantes de los canales

Por ejemplo, un canal de línea de tiempo emitiría un mensaje cuando hubiera una nueva publicación.Al recibir ese mensaje, sabrás en tiempo real que se ha publicado una nueva entrada en tu cronología.

Cuando un canal emite un mensaje, se transmiten los siguientes datos en JSON:

```js
{
	type: 'channel',
	body: {
		id: 'foobar',
		type: 'something',
		body: {
			some: 'thing'
		}
	}
}
```

Aquí

- El `id` se establece en el ID establecido al conectarse a ese canal como se ha descrito anteriormente.Esto le permitirá saber de qué canal procede este mensaje.
- El `type` se establece en el tipo de mensaje.El tipo de mensajes que se emitirán depende del canal.
- El `body` se establece con el contenido del mensaje.El tipo de contenido de los mensajes variará en función del canal.

### Enviar mensajes al canal

Dependiendo del canal, es posible que no solo recibas mensajes, sino que también puedas enviar algunos mensajes nuestros y realizar algunas operaciones.

Para enviar un mensaje a un canal, envía los siguientes datos al flujo en JSON:.

```js
{
	type: 'channel',
	body: {
		id: 'foobar',
		type: 'something',
		body: {
			some: 'thing'
		}
	}
}
```

Aquí

- El `id` se establece en el ID establecido al conectarse a ese canal como se ha descrito anteriormente.Esto permite al usuario identificar a qué canal va dirigido este mensaje.
- El `type` se establece en el tipo de mensaje.Los distintos canales aceptan diferentes tipos de mensajes.
- El `body` se establece con el contenido del mensaje.Los distintos canales aceptan distintos tipos de mensajes con contenidos diferentes.

### Desconectarse del canal

Para desconectarse de un canal, envía los siguientes datos al flujo en JSON:

```js
{
	type: 'disconnect',
	body: {
		id: 'foobar'
	}
}
```

Aquí

- El `id` se establece en el ID establecido al conectarse a ese canal como se ha descrito anteriormente.

## Capturar posts

Misskey ofrece una construcción llamada "captura de posts". Es una función para recibir en el stream los eventos de un post seleccionado.

Por ejemplo, supongamos que se obtiene la línea de tiempo y se la muestra al usuario. Supongamos que alguien reacciona a una de las entradas de la cronología.
Sin embargo, el cliente no tiene forma de saber que se ha reaccionado a una publicación, por lo que no es posible reflejar la reacción en la línea de tiempo en tiempo real.

Para resolver este problema, Misskey proporciona un mecanismo de captura posterior.Cuando capturas una publicación, puedes recibir eventos sobre ella, lo que te permite reflejar tus reacciones en tiempo real.

A continuación encontrarás instrucciones sobre cómo utilizar la función Capturar Post.Para ver qué eventos de captura están disponibles, consulta [Lista de eventos de captura] (./note-capture-events.md).

### Capturar Post

Para capturar una entrada, envíe el siguiente mensaje al flujo:.

```js
{
	type: 'subNote',
	body: {
		id: 'xxxxxxxxxxxxxxxx'
	}
}
```

Aquí

- Establece `id` como `id` de la entrada que deseas capturar.

Cuando envías este mensaje, estás solicitando una captura de Misskey y, en lo sucesivo, los eventos relacionados con esa publicación te serán transmitidos.

Por ejemplo, si recibes una reacción a una publicación, recibirás un mensaje como este:.

```js
{
	type: 'noteUpdated',
	body: {
		id: 'xxxxxxxxxxxxxxxx',
		type: 'reacted',
		body: {
			reaction: 'like',
			userId: 'yyyyyyyyyyyyyyyy'
		}
	}
}
```

Aquí

- El `id` en el `body` se establece en el ID de la entrada que desencadenó el evento.
- El `type` en el `body` se establece en el tipo de evento.
- Los detalles del evento se establecen en `body` dentro de `body`.

### Cancelar la captura del post

Si la publicación ya no está visible en tu pantalla y ya no deseas recibir eventos relacionados con esa publicación, solicita que se elimine la captura.

Envía el siguiente mensaje:

```js
{
	type: 'unsubNote',
	body: {
		id: 'xxxxxxxxxxxxxxxx'
	}
}
```

Aquí

- Establezca `id` en el `id` de la publicación de la que desea eliminar el captcha.

Una vez que envíe este mensaje, no se te enviarán más eventos para esa publicación.
